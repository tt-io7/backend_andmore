import{r as C}from"./chunk-K7S5TX6I-BT9aJpBt.js";import{f}from"./chunk-OV5NMSY6-CzJZ0JaW.js";import{a as B}from"./chunk-7DXVXBSA-u0lQbI_F.js";import{a as j,g}from"./chunk-PDWBYQOW-Dmlh1vBq.js";import{j as e,b as m,H as R,T as i,Y as S,V as y,A as M,B as A,r as D,E as H,t as x,b4 as k}from"./index-nuRy4NPt.js";import{u as O}from"./chunk-3UEMCYR5-m-tGqwLe.js";import{D as E}from"./document-text-D9NMsbqJ.js";import{A as _}from"./arrow-down-right-mini-BsYcT81r.js";import{u as I}from"./use-prompt-ElzrivZ1.js";import{X as W}from"./x-circle-Cread-AV.js";import{T as X}from"./Trans-DSvUInAx.js";import{C as $}from"./container-Ceh_4PzF.js";import{S as v}from"./status-badge-Dg3vkrej.js";import{f as N}from"./format-8c3j_kPt.js";var q=k(C());function F({id:t,className:s}){const{t:a}=m(),[r,n]=D.useState(!1),o=()=>{(0,q.default)(t),x.success(a("actions.idCopiedToClipboard"))};return e.jsx(y,{maxWidth:260,content:t,open:r,onOpenChange:n,children:e.jsxs("span",{onClick:o,className:H("cursor-pointer",s),children:["#",t.slice(-7)]})})}var h=F,K=t=>t.reduce((s,a)=>(s=s+(a.captured_amount-a.refunded_amount),s),0),L=t=>t.reduce((s,a)=>(s+=a.amount-a.captured_amount,s),0),V=t=>t.payment_collections.map(s=>s.payments).flat(1).filter(Boolean),ue=({order:t})=>{const s=V(t),a=s.map(r=>r==null?void 0:r.refunds).flat(1).filter(Boolean);return e.jsxs($,{className:"divide-y divide-dashed p-0",children:[e.jsx(Y,{order:t}),e.jsx(J,{order:t,payments:s,refunds:a,currencyCode:t.currency_code}),e.jsx(Q,{order:t})]})},Y=({order:t})=>{const{t:s}=m(),{label:a,color:r}=B(s,t.payment_status);return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(R,{level:"h2",children:s("orders.payment.title")}),e.jsx(v,{color:r,className:"text-nowrap",children:a})]})},w=({refund:t,currencyCode:s})=>{const{t:a}=m(),r=(t==null?void 0:t.refund_reason)&&e.jsx(S,{size:"2xsmall",className:"cursor-default select-none capitalize",rounded:"full",children:t.refund_reason.label}),n=t.note&&e.jsx(y,{content:t.note,children:e.jsx(E,{className:"text-ui-tag-neutral-icon ml-1 inline"})});return e.jsxs("div",{className:"bg-ui-bg-subtle text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"self-center pr-3",children:e.jsx(_,{className:"text-ui-fg-muted"})}),e.jsxs("div",{children:[e.jsxs(i,{size:"small",leading:"compact",weight:"plus",children:[a("orders.payment.refund")," ",n]}),e.jsx(i,{size:"small",leading:"compact",children:N(new Date(t.created_at),"dd MMM, yyyy, HH:mm:ss")})]})]}),e.jsx("div",{className:"flex items-center justify-end",children:r}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(i,{size:"small",leading:"compact",children:["- ",g(t.amount,s)]})})]})},G=({order:t,payment:s,refunds:a,currencyCode:r})=>{const{t:n}=m(),o=I(),{mutateAsync:c}=O(t.id,s.id),l=async()=>{await o({title:n("orders.payment.capture"),description:n("orders.payment.capturePayment",{amount:f(s.amount,r)}),confirmText:n("actions.confirm"),cancelText:n("actions.cancel"),variant:"confirmation"})&&await c({amount:s.amount},{onSuccess:()=>{x.success(n("orders.payment.capturePaymentSuccess",{amount:f(s.amount,r)}))},onError:p=>{x.error(p.message)}})},u=d=>d.canceled_at?["Canceled","red"]:d.captured_at?["Captured","green"]:["Pending","orange"],[b,z]=u(s),T=s.captured_at===null&&s.canceled_at===null,P=s.refunds.reduce((d,p)=>p.amount+d,0);return e.jsxs("div",{className:"divide-y divide-dashed",children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4 sm:grid-cols-[1fr_1fr_1fr_1fr_20px]",children:[e.jsxs("div",{className:"w-full min-w-[60px] overflow-hidden",children:[e.jsx(i,{size:"small",leading:"compact",weight:"plus",className:"truncate",children:e.jsx(h,{id:s.id})}),e.jsx(i,{size:"small",leading:"compact",children:N(new Date(s.created_at),"dd MMM, yyyy, HH:mm:ss")})]}),e.jsx("div",{className:"hidden items-center justify-end sm:flex",children:e.jsx(i,{size:"small",leading:"compact",className:"capitalize",children:s.provider_id})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(v,{color:z,className:"text-nowrap",children:b})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(i,{size:"small",leading:"compact",children:g(s.amount,s.currency_code)})}),e.jsx(M,{groups:[{actions:[{label:n("orders.payment.refund"),icon:e.jsx(W,{}),to:`/orders/${t.id}/refund?paymentId=${s.id}`,disabled:!s.captured_at||!!s.canceled_at||P>=s.amount}]}]})]}),T&&e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(_,{className:"text-ui-fg-muted shrink-0"}),e.jsx(i,{size:"small",leading:"compact",children:e.jsx(X,{i18nKey:"orders.payment.isReadyToBeCaptured",components:[e.jsx(h,{id:s.id})]})})]}),e.jsxs(A,{className:"shrink-0",size:"small",variant:"secondary",onClick:l,children:[e.jsx("span",{className:"hidden sm:block",children:n("orders.payment.capture")}),e.jsx("span",{className:"sm:hidden",children:n("orders.payment.capture_short")})]})]}),a.map(d=>e.jsx(w,{refund:d,currencyCode:r},d.id))]})},J=({order:t,payments:s,refunds:a,currencyCode:r})=>{const o=[...a.filter(c=>c.payment_id===null),...s].sort((c,l)=>new Date(c.created_at).getTime()-new Date(l.created_at).getTime()).map(c=>({event:c,type:c.id.startsWith("pay_")?"payment":"refund"}));return e.jsx("div",{className:"flex flex-col divide-y divide-dashed",children:o.map(({type:c,event:l})=>{switch(c){case"payment":return e.jsx(G,{order:t,payment:l,refunds:a.filter(u=>u.payment_id===l.id),currencyCode:r},l.id);case"refund":return e.jsx(w,{refund:l,currencyCode:r},l.id)}})})},Q=({order:t})=>{const{t:s}=m(),a=L(t.payment_collections);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:s("orders.payment.totalPaidByCustomer")}),e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:j(K(t.payment_collections),t.currency_code)})]}),t.status!=="canceled"&&a>0&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:"Total pending"}),e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:j(a,t.currency_code)})]})]})};export{ue as O,V as a,K as g};
