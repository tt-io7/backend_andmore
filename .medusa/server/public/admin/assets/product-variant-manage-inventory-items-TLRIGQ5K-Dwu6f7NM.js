import{V as C}from"./chunk-EUTK2A3J-CZpwcbuN.js";import{u as V}from"./chunk-6CNRNROJ-C5WnNS5_.js";import{C as E}from"./chunk-3LLQ6F7F-zUnJDr5H.js";import{c as x}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as w}from"./chunk-6HTZNHPT-DkoPnsal.js";import{R as m,u as M}from"./chunk-JGQGO74V-DhFWNNdE.js";import{R as P,a6 as S,j as e,b as T,a8 as R,w as z,aF as L,t as v,B as h,H as k,v as o,x as g,I as A,y as B,ab as $,s as H,a2 as j,ad as K,ae as D,a4 as q,af as X,an as b,aG as G}from"./index-nuRy4NPt.js";import{X as O}from"./x-mark-mini-BdmWTrOK.js";import"./triangles-mini-CFjcr5v5.js";import"./plus-mini-N6Rr5zC6.js";import"./prompt-CKgRI8ea.js";var Z=j({inventory:K(j({inventory_item_id:q().min(1,b.t("products.variant.inventory.validation.itemId")),required_quantity:D([X(),q()])}).superRefine((i,n)=>{(i.required_quantity?x(i.required_quantity):0)<1&&n.addIssue({code:G.custom,message:b.t("products.variant.inventory.validation.quantity"),path:["required_quantity"]})}))});function J({variant:i}){var _,f;const{t:n}=T(),{handleSuccess:u}=M(),d=R({defaultValues:{inventory:i.inventory_items.length?i.inventory_items.map(a=>({required_quantity:a.required_quantity,inventory_item_id:a.inventory.id})):[{inventory_item_id:"",required_quantity:""}]},resolver:$(Z)}),l=z({control:d.control,name:"inventory"}),y=l.fields.length>1,p=V({queryKey:["inventory_items"],queryFn:a=>H.admin.inventoryItem.list(a),getOptions:a=>a.inventory_items.map(s=>({label:s.title||s.sku,value:s.id})),defaultValue:(f=(_=i.inventory_items)==null?void 0:_[0])==null?void 0:f.inventory_item_id}),{mutateAsync:I,isPending:N}=L(i==null?void 0:i.product_id),F=d.handleSubmit(async a=>{const s={},c={};i.inventory_items.forEach(t=>s[t.inventory.id]=t.required_quantity),a.inventory.forEach(t=>c[t.inventory_item_id]=!0);const r={};a.inventory.forEach(t=>{t.inventory_item_id in s?t.required_quantity!==s[t.inventory_item_id]&&(r.update=r.update||[],r.update.push({required_quantity:x(t.required_quantity),inventory_item_id:t.inventory_item_id,variant_id:i.id})):(r.create=r.create||[],r.create.push({required_quantity:x(t.required_quantity),inventory_item_id:t.inventory_item_id,variant_id:i.id}))}),i.inventory_items.forEach(t=>{t.inventory.id in c||(r.delete=r.delete||[],r.delete.push({inventory_item_id:t.inventory.id,variant_id:i.id}))}),await I(r,{onSuccess:()=>{v.success(n("products.variant.inventory.toast.itemsManageSuccess")),u()},onError:t=>{v.error(t.message)}})});return e.jsx(m.Form,{form:d,children:e.jsxs(w,{className:"flex h-full flex-col overflow-hidden",onSubmit:F,children:[e.jsx(m.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(h,{size:"small",variant:"secondary",children:n("actions.cancel")})}),e.jsx(h,{size:"small",type:"submit",isLoading:N,children:n("actions.save")})]})}),e.jsx(m.Body,{className:"flex justify-center",children:e.jsxs("div",{className:"flex w-full flex-col gap-y-8 px-6 pt-12 md:w-[720px] md:pt-24",children:[e.jsx(k,{children:n(y?"products.create.inventory.heading":"fields.inventoryItems")}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o.Label,{children:i.title}),e.jsx(o.Hint,{children:n(y?"products.create.inventory.label":"fields.inventoryItem")})]}),e.jsx(h,{size:"small",variant:"secondary",type:"button",onClick:()=>{l.append({inventory_item_id:"",required_quantity:""})},children:n("actions.add")})]}),l.fields.map((a,s)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(g,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${s}.inventory_item_id`,children:n("fields.item")})}),e.jsx(o.Field,{control:d.control,name:`inventory.${s}.inventory_item_id`,render:({field:c})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(E,{...c,options:p.options,searchValue:p.searchValue,onSearchValueChange:p.onSearchValueChange,fetchNextPage:p.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:n("products.create.inventory.itemPlaceholder")})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(g,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${s}.required_quantity`,children:n("fields.quantity")})}),e.jsx(o.Field,{control:d.control,name:`inventory.${s}.required_quantity`,render:({field:{onChange:c,value:r,...t}})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(A,{type:"number",className:"bg-ui-bg-field-component",min:0,value:r,onChange:c,...t,placeholder:n("products.create.inventory.quantityPlaceholder")})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:()=>l.remove(s),children:e.jsx(O,{})})]},a.id))]})]})})]})})}function oe(){const{id:i,variant_id:n}=P(),{variant:u,isPending:d,isError:l,error:y}=S(i,n,{fields:C});if(l)throw y;return e.jsx(m,{children:!d&&u&&e.jsx(J,{variant:u})})}export{oe as Component};
